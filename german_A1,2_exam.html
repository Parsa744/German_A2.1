<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Grammar A1 & A2 Exam</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .exam-info {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .exam-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #e74c3c;
            padding: 10px 20px;
            background: #fff;
            border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            flex: 1;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            margin: 0 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .score {
            font-size: 1.1rem;
            font-weight: bold;
            color: #27ae60;
            padding: 10px 20px;
            background: #fff;
            border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .question-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .question-container.correct {
            border-left: 5px solid #27ae60;
            background: rgba(46, 204, 113, 0.1);
        }

        .question-container.incorrect {
            border-left: 5px solid #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .question-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            background: #f8f9ff;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .question-level {
            font-size: 0.9rem;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
        }

        .level-a1 {
            background: #e8f5e8;
            color: #27ae60;
        }

        .level-a2 {
            background: #fff3cd;
            color: #f39c12;
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .question-context {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
            font-style: italic;
        }

        .options {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option {
            padding: 15px 20px;
            border: 2px solid #ecf0f1;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #f8f9ff;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .option.correct {
            border-color: #27ae60;
            background: #e8f5e8;
            color: #27ae60;
        }

        .option.incorrect {
            border-color: #e74c3c;
            background: #fdf2f2;
            color: #e74c3c;
        }

        .option-letter {
            font-weight: bold;
            font-size: 1.1rem;
            min-width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .selected .option-letter {
            background: #667eea;
            color: white;
        }

        .correct .option-letter {
            background: #27ae60;
            color: white;
        }

        .incorrect .option-letter {
            background: #e74c3c;
            color: white;
        }

        .input-question {
            margin-bottom: 20px;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .text-input.correct {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .text-input.incorrect {
            border-color: #e74c3c;
            background: #fdf2f2;
        }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .feedback.correct {
            background: #e8f5e8;
            border-left: 4px solid #27ae60;
            color: #27ae60;
        }

        .feedback.incorrect {
            background: #fdf2f2;
            border-left: 4px solid #e74c3c;
            color: #e74c3c;
        }

        .explanation {
            margin-top: 10px;
            font-size: 0.95rem;
            color: #666;
            font-style: italic;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .btn-secondary:hover {
            background: #bdc3c7;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .results-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            display: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .results-container.show {
            display: block;
            animation: slideUp 0.5s ease;
        }

        .final-score {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .score-excellent {
            color: #27ae60;
        }

        .score-good {
            color: #f39c12;
        }

        .score-needs-improvement {
            color: #e74c3c;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .score-item {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #667eea;
        }

        .score-item h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .score-item .number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .exam-controls {
                flex-direction: column;
                text-align: center;
            }

            .progress-bar {
                margin: 15px 0;
            }

            .question-container {
                padding: 20px;
            }

            .score-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üá©üá™ German Grammar Exam</h1>
            <p>A1 & A2 Level Comprehensive Test</p>
        </div>

        <div class="exam-info">
            <div class="exam-controls">
                <div class="timer" id="timer">‚è±Ô∏è 45:00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="score" id="currentScore">Score: 0/0</div>
            </div>
            <p><strong>Instructions:</strong> Complete all 30 questions to test your German grammar knowledge. You have 45 minutes. Click on your answers and get immediate feedback!</p>
        </div>

        <div id="examContainer">
            <!-- Questions will be inserted here -->
        </div>

        <div class="action-buttons" id="actionButtons">
            <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>‚Üê Previous</button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Next ‚Üí</button>
            <button class="btn btn-primary" id="finishBtn" onclick="finishExam()" style="display: none;">Finish Exam</button>
        </div>

        <div class="results-container" id="resultsContainer">
            <h2>üéâ Exam Complete!</h2>
            <div class="final-score" id="finalScore">85%</div>
            <p id="scoreMessage">Excellent work! You have a strong grasp of German grammar.</p>
            
            <div class="score-breakdown">
                <div class="score-item">
                    <h3>Total Score</h3>
                    <div class="number" id="totalScore">25/30</div>
                </div>
                <div class="score-item">
                    <h3>A1 Level</h3>
                    <div class="number" id="a1Score">14/15</div>
                </div>
                <div class="score-item">
                    <h3>A2 Level</h3>
                    <div class="number" id="a2Score">11/15</div>
                </div>
                <div class="score-item">
                    <h3>Time Used</h3>
                    <div class="number" id="timeUsed">32:15</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="restartExam()">üîÑ Retake Exam</button>
                <a href="#" class="btn btn-secondary">üìö Review Grammar</a>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            // A1 Questions
            {
                id: 1,
                level: "A1",
                topic: "Articles",
                type: "multiple",
                question: "Choose the correct article for 'Buch' (book):",
                options: ["der Buch", "die Buch", "das Buch", "dem Buch"],
                correct: 2,
                explanation: "'Buch' is neuter, so it takes 'das' as the definite article."
            },
            {
                id: 2,
                level: "A1",
                topic: "Verb Conjugation",
                type: "multiple",
                question: "Complete: 'Ich ____ Deutsch.'",
                options: ["spreche", "sprichst", "sprechen", "spricht"],
                correct: 0,
                explanation: "With 'ich', we use the first person singular form 'spreche'."
            },
            {
                id: 3,
                level: "A1",
                topic: "Plural",
                type: "input",
                question: "Write the plural form of 'Kind' (child):",
                answer: ["Kinder", "kinder"],
                explanation: "'Kind' forms its plural by adding '-er': Kinder."
            },
            {
                id: 4,
                level: "A1",
                topic: "Possessive Pronouns",
                type: "multiple",
                question: "Choose the correct possessive: 'Das ist ____ Auto.' (my car)",
                options: ["mein", "meine", "meinen", "meiner"],
                correct: 0,
                explanation: "'Auto' is neuter, so we use 'mein' (no ending in nominative)."
            },
            {
                id: 5,
                level: "A1",
                topic: "Modal Verbs",
                type: "multiple",
                question: "Complete: 'Du ____ heute arbeiten.' (must)",
                options: ["musst", "muss", "m√ºssen", "m√ºsst"],
                correct: 0,
                explanation: "With 'du', the modal verb 'm√ºssen' becomes 'musst'."
            },
            {
                id: 6,
                level: "A1",
                topic: "Word Order",
                type: "multiple",
                question: "Choose the correct word order:",
                options: [
                    "Ich heute gehe ins Kino.",
                    "Heute gehe ich ins Kino.",
                    "Ins Kino ich gehe heute.",
                    "Gehe ich heute ins Kino."
                ],
                correct: 1,
                explanation: "The verb must be in position 2. 'Heute' (time) comes first, then 'gehe' (verb), then 'ich' (subject)."
            },
            {
                id: 7,
                level: "A1",
                topic: "Questions",
                type: "multiple",
                question: "Which W-word asks for a person?",
                options: ["Was", "Wo", "Wer", "Wann"],
                correct: 2,
                explanation: "'Wer' means 'who' and is used to ask about people."
            },
            {
                id: 8,
                level: "A1",
                topic: "Negation",
                type: "multiple",
                question: "Complete: 'Ich habe ____ Auto.' (no car)",
                options: ["nicht", "kein", "keine", "keinen"],
                correct: 1,
                explanation: "'Auto' is neuter, so we use 'kein' to negate it (replaces 'ein')."
            },
            {
                id: 9,
                level: "A1",
                topic: "Accusative",
                type: "multiple",
                question: "Choose the correct accusative form: 'Ich sehe ____ Mann.'",
                options: ["der", "den", "dem", "des"],
                correct: 1,
                explanation: "Masculine nouns in accusative take 'den' instead of 'der'."
            },
            {
                id: 10,
                level: "A1",
                topic: "Separable Verbs",
                type: "multiple",
                question: "Complete: 'Ich ____ um 7 Uhr ____.' (get up)",
                options: ["stehe ... auf", "aufstehe", "stehe auf", "auf stehe"],
                correct: 0,
                explanation: "Separable verbs split: the prefix 'auf' goes to the end."
            },
            {
                id: 11,
                level: "A1",
                topic: "Time",
                type: "multiple",
                question: "What time is 'halb drei'?",
                options: ["3:30", "2:30", "3:15", "2:45"],
                correct: 1,
                explanation: "'Halb drei' means 'half to three', which is 2:30."
            },
            {
                id: 12,
                level: "A1",
                topic: "Dative Prepositions",
                type: "multiple",
                question: "Complete: 'Ich fahre ____ dem Bus.'",
                options: ["mit", "f√ºr", "durch", "ohne"],
                correct: 0,
                explanation: "'Mit' (with) always takes dative case."
            },
            {
                id: 13,
                level: "A1",
                topic: "Personal Pronouns",
                type: "multiple",
                question: "Replace 'die Katze': 'Ich sehe ____.'",
                options: ["sie", "es", "ihn", "ihr"],
                correct: 0,
                explanation: "'Die Katze' is feminine, so we use 'sie' in accusative."
            },
            {
                id: 14,
                level: "A1",
                topic: "Imperative",
                type: "multiple",
                question: "Choose the correct imperative (du-form): 'Come here!'",
                options: ["Kommst hier!", "Komm her!", "Kommen Sie her!", "Kommt her!"],
                correct: 1,
                explanation: "Du-imperative uses the verb stem: 'Komm her!'"
            },
            {
                id: 15,
                level: "A1",
                topic: "Irregular Verbs",
                type: "input",
                question: "Complete with 'haben': 'Du ____ einen Hund.'",
                answer: ["hast"],
                explanation: "'Haben' with 'du' becomes 'hast'."
            },

            // A2 Questions
            {
                id: 16,
                level: "A2",
                topic: "Perfect Tense",
                type: "multiple",
                question: "Choose the correct perfect tense: 'Ich ____ nach Berlin ____.'",
                options: ["habe ... gefahren", "bin ... gefahren", "habe ... fahren", "bin ... fahren"],
                correct: 1,
                explanation: "'Fahren' (travel) indicates movement, so it uses 'sein' + past participle."
            },
            {
                id: 17,
                level: "A2",
                topic: "Reflexive Verbs",
                type: "multiple",
                question: "Complete: 'Wir ____ ____ √ºber das Geschenk.' (are happy about)",
                options: ["freuen uns", "freuen sich", "uns freuen", "sich freuen"],
                correct: 0,
                explanation: "'Sich freuen' with 'wir' becomes 'freuen uns'."
            },
            {
                id: 18,
                level: "A2",
                topic: "Comparative",
                type: "input",
                question: "Write the comparative of 'gut' (good):",
                answer: ["besser"],
                explanation: "'Gut' has an irregular comparative form: 'besser'."
            },
            {
                id: 19,
                level: "A2",
                topic: "Subordinate Clauses",
                type: "multiple",
                question: "Choose the correct word order: 'Ich wei√ü, dass...'",
                options: [
                    "er kommt morgen",
                    "er morgen kommt",
                    "kommt er morgen",
                    "morgen er kommt"
                ],
                correct: 1,
                explanation: "In subordinate clauses, the verb goes to the end: 'er morgen kommt'."
            },
            {
                id: 20,
                level: "A2",
                topic: "Adjective Endings",
                type: "multiple",
                question: "Complete: 'Der gro√ü____ Mann ist mein Vater.'",
                options: ["e", "er", "en", "es"],
                correct: 0,
                explanation: "After definite articles, adjectives take '-e' in nominative: 'gro√üe'."
            },
            {
                id: 21,
                level: "A2",
                topic: "Two-way Prepositions",
                type: "multiple",
                question: "Complete: 'Das Buch liegt ____ ____ Tisch.' (on the table - location)",
                options: ["auf den", "auf dem", "auf der", "auf das"],
                correct: 1,
                explanation: "Location (wo?) uses dative: 'auf dem Tisch' (masculine dative)."
            },
            {
                id: 22,
                level: "A2",
                topic: "Relative Clauses",
                type: "multiple",
                question: "Complete: 'Der Mann, ____ dort steht, ist mein Lehrer.'",
                options: ["den", "der", "dem", "des"],
                correct: 1,
                explanation: "The relative pronoun agrees with 'Mann' (masculine, nominative): 'der'."
            },
            {
                id: 23,
                level: "A2",
                topic: "Future Tense",
                type: "multiple",
                question: "Complete: 'Morgen ____ ich nach M√ºnchen ____.'",
                options: ["werde ... fahren", "will ... fahren", "fahre ... werden", "bin ... fahren"],
                correct: 0,
                explanation: "Future tense uses 'werden + infinitive': 'werde fahren'."
            },
            {
                id: 24,
                level: "A2",
                topic: "Passive Voice",
                type: "multiple",
                question: "Transform to passive: 'Der Koch kocht das Essen.'",
                options: [
                    "Das Essen kocht der Koch.",
                    "Das Essen wird gekocht.",
                    "Das Essen ist gekocht.",
                    "Das Essen hat gekocht."
                ],
                correct: 1,
                explanation: "Passive uses 'werden + past participle': 'wird gekocht'."
            },
            {
                id: 25,
                level: "A2",
                topic: "Dative Verbs",
                type: "multiple",
                question: "Complete: 'Das Buch gef√§llt ____.' (I like the book)",
                options: ["mich", "mir", "ich", "meinen"],
                correct: 1,
                explanation: "'Gefallen' always takes dative: 'mir' (to me)."
            },
            {
                id: 26,
                level: "A2",
                topic: "Modal Verbs A2",
                type: "multiple",
                question: "Complete: 'Du ____ hier nicht rauchen.' (are not allowed)",
                options: ["darfst nicht", "musst nicht", "kannst nicht", "sollst nicht"],
                correct: 0,
                explanation: "'D√ºrfen' expresses permission; 'darfst nicht' means 'are not allowed'."
            },
            {
                id: 27,
                level: "A2",
                topic: "Superlative",
                type: "input",
                question: "Write the superlative of 'schnell' (fast): 'am ____'",
                answer: ["schnellsten"],
                explanation: "Superlative: 'am' + adjective + '-sten': 'am schnellsten'."
            },
            {
                id: 28,
                level: "A2",
                topic: "Past Modal Verbs",
                type: "multiple",
                question: "Complete in past tense: 'Gestern ____ ich arbeiten.' (had to)",
                options: ["musste", "muss", "m√ºssen", "gemusst"],
                correct: 0,
                explanation: "'M√ºssen' in past tense (Pr√§teritum) is 'musste'."
            },
            {
                id: 29,
                level: "A2",
                topic: "Genitive",
                type: "multiple",
                question: "Complete: 'Das Auto ____ Mannes ist rot.' (of the man)",
                options: ["der", "dem", "den", "des"],
                correct: 3,
                explanation: "Genitive masculine: 'des Mannes' (note the -es ending)."
            },
            {
                id: 30,
                level: "A2",
                topic: "Complex Sentences",
                type: "multiple",
                question: "Choose the correct sentence with 'weil':",
                options: [
                    "Ich bin m√ºde, weil ich habe viel gearbeitet.",
                    "Ich bin m√ºde, weil ich viel gearbeitet habe.",
                    "Ich bin m√ºde, weil habe ich viel gearbeitet.",
                    "Ich bin m√ºde, weil viel gearbeitet ich habe."
                ],
                correct: 1,
                explanation: "In 'weil' clauses, the auxiliary verb goes to the end: 'gearbeitet habe'."
            }
        ];

        let currentQuestion = 0;
        let userAnswers = {};
        let score = 0;
        let timeLeft = 45 * 60; // 45 minutes in seconds
        let timerInterval;
        let examStartTime;

        function startExam() {
            examStartTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            displayQuestion();
        }

        function updateTimer() {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = `‚è±Ô∏è ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                finishExam();
            }
        }

        function displayQuestion() {
            const question = questions[currentQuestion];
            const container = document.getElementById('examContainer');
            
            let questionHTML = `
                <div class="question-container" id="question-${question.id}">
                    <div class="question-header">
                        <div class="question-number">Question ${question.id}/30</div>
                        <div class="question-level level-${question.level.toLowerCase()}">${question.level} - ${question.topic}</div>
                    </div>
                    <div class="question-text">${question.question}</div>
            `;

            if (question.type === 'multiple') {
                questionHTML += '<div class="options">';
                question.options.forEach((option, index) => {
                    const letter = String.fromCharCode(65 + index); // A, B, C, D
                    const isSelected = userAnswers[question.id] === index;
                    questionHTML += `
                        <div class="option ${isSelected ? 'selected' : ''}" onclick="selectOption(${question.id}, ${index})">
                            <div class="option-letter">${letter}</div>
                            <div class="option-text">${option}</div>
                        </div>
                    `;
                });
                questionHTML += '</div>';
            } else if (question.type === 'input') {
                const userAnswer = userAnswers[question.id] || '';
                questionHTML += `
                    <div class="input-question">
                        <input type="text" class="text-input" id="input-${question.id}" 
                               value="${userAnswer}" onchange="handleInputAnswer(${question.id}, this.value)"
                               placeholder="Type your answer here...">
                    </div>
                `;
            }

            questionHTML += `
                    <div class="feedback" id="feedback-${question.id}">
                        <div class="explanation"></div>
                    </div>
                </div>
            `;

            container.innerHTML = questionHTML;
            updateProgress();
            updateButtons();
            updateScore();

            // Show feedback if question was already answered
            if (userAnswers[question.id] !== undefined) {
                showFeedback(question.id);
            }
        }

        function selectOption(questionId, optionIndex) {
            userAnswers[questionId] = optionIndex;
            
            // Update visual selection
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                option.classList.toggle('selected', index === optionIndex);
            });

            showFeedback(questionId);
        }

        function handleInputAnswer(questionId, value) {
            userAnswers[questionId] = value.trim();
            if (value.trim()) {
                showFeedback(questionId);
            }
        }

        function showFeedback(questionId) {
            const question = questions.find(q => q.id === questionId);
            const feedback = document.getElementById(`feedback-${questionId}`);
            const questionContainer = document.getElementById(`question-${questionId}`);
            
            let isCorrect = false;
            
            if (question.type === 'multiple') {
                isCorrect = userAnswers[questionId] === question.correct;
                
                // Update option styling
                const options = document.querySelectorAll('.option');
                options.forEach((option, index) => {
                    option.classList.remove('correct', 'incorrect');
                    if (index === question.correct) {
                        option.classList.add('correct');
                    } else if (index === userAnswers[questionId] && !isCorrect) {
                        option.classList.add('incorrect');
                    }
                });
            } else if (question.type === 'input') {
                const userAnswer = userAnswers[questionId];
                isCorrect = question.answer.some(correctAnswer => 
                    userAnswer.toLowerCase() === correctAnswer.toLowerCase()
                );
                
                const input = document.getElementById(`input-${questionId}`);
                input.classList.remove('correct', 'incorrect');
                input.classList.add(isCorrect ? 'correct' : 'incorrect');
            }

            // Update question container styling
            questionContainer.classList.remove('correct', 'incorrect');
            questionContainer.classList.add(isCorrect ? 'correct' : 'incorrect');

            // Show feedback
            feedback.classList.remove('correct', 'incorrect');
            feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
            feedback.classList.add('show');
            
            const explanationDiv = feedback.querySelector('.explanation');
            explanationDiv.innerHTML = `
                <strong>${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect'}</strong><br>
                ${question.explanation}
            `;

            updateScore();
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');

            prevBtn.disabled = currentQuestion === 0;
            
            if (currentQuestion === questions.length - 1) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'inline-block';
            } else {
                nextBtn.style.display = 'inline-block';
                finishBtn.style.display = 'none';
            }
        }

        function updateScore() {
            let correctAnswers = 0;
            let answeredQuestions = 0;

            Object.keys(userAnswers).forEach(questionId => {
                const question = questions.find(q => q.id == questionId);
                answeredQuestions++;
                
                if (question.type === 'multiple') {
                    if (userAnswers[questionId] === question.correct) {
                        correctAnswers++;
                    }
                } else if (question.type === 'input') {
                    const userAnswer = userAnswers[questionId];
                    if (question.answer.some(correctAnswer => 
                        userAnswer.toLowerCase() === correctAnswer.toLowerCase())) {
                        correctAnswers++;
                    }
                }
            });

            score = correctAnswers;
            document.getElementById('currentScore').textContent = `Score: ${correctAnswers}/${answeredQuestions}`;
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                displayQuestion();
            }
        }

        function finishExam() {
            clearInterval(timerInterval);
            
            // Calculate final scores
            let totalCorrect = 0;
            let a1Correct = 0;
            let a2Correct = 0;
            let a1Total = 0;
            let a2Total = 0;

            questions.forEach(question => {
                if (question.level === 'A1') {
                    a1Total++;
                } else {
                    a2Total++;
                }

                const isCorrect = checkAnswer(question);
                if (isCorrect) {
                    totalCorrect++;
                    if (question.level === 'A1') {
                        a1Correct++;
                    } else {
                        a2Correct++;
                    }
                }
            });

            const percentage = Math.round((totalCorrect / questions.length) * 100);
            const timeUsed = Math.floor((Date.now() - examStartTime) / 1000);
            const timeUsedFormatted = `${Math.floor(timeUsed / 60)}:${(timeUsed % 60).toString().padStart(2, '0')}`;

            // Update results
            document.getElementById('finalScore').textContent = `${percentage}%`;
            document.getElementById('totalScore').textContent = `${totalCorrect}/${questions.length}`;
            document.getElementById('a1Score').textContent = `${a1Correct}/${a1Total}`;
            document.getElementById('a2Score').textContent = `${a2Correct}/${a2Total}`;
            document.getElementById('timeUsed').textContent = timeUsed < 60 ? `${timeUsed}s` : timeUsedFormatted;

            // Set score styling and message
            const finalScoreElement = document.getElementById('finalScore');
            const scoreMessage = document.getElementById('scoreMessage');
            
            finalScoreElement.classList.remove('score-excellent', 'score-good', 'score-needs-improvement');
            
            if (percentage >= 90) {
                finalScoreElement.classList.add('score-excellent');
                scoreMessage.textContent = "üåü Excellent! You have mastered German grammar at this level!";
            } else if (percentage >= 70) {
                finalScoreElement.classList.add('score-good');
                scoreMessage.textContent = "üëç Good work! You have a solid understanding with room for improvement.";
            } else {
                finalScoreElement.classList.add('score-needs-improvement');
                scoreMessage.textContent = "üìö Keep studying! Review the grammar rules and practice more.";
            }

            // Hide exam, show results
            document.getElementById('examContainer').style.display = 'none';
            document.getElementById('actionButtons').style.display = 'none';
            document.querySelector('.exam-info').style.display = 'none';
            document.getElementById('resultsContainer').classList.add('show');
        }

        function checkAnswer(question) {
            const userAnswer = userAnswers[question.id];
            if (userAnswer === undefined) return false;

            if (question.type === 'multiple') {
                return userAnswer === question.correct;
            } else if (question.type === 'input') {
                return question.answer.some(correctAnswer => 
                    userAnswer.toLowerCase() === correctAnswer.toLowerCase()
                );
            }
            return false;
        }

        function restartExam() {
            // Reset all variables
            currentQuestion = 0;
            userAnswers = {};
            score = 0;
            timeLeft = 45 * 60;
            
            // Reset display
            document.getElementById('resultsContainer').classList.remove('show');
            document.getElementById('examContainer').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'flex';
            document.querySelector('.exam-info').style.display = 'block';
            
            // Restart exam
            startExam();
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' && currentQuestion > 0) {
                previousQuestion();
            } else if (e.key === 'ArrowRight' && currentQuestion < questions.length - 1) {
                nextQuestion();
            } else if (e.key >= '1' && e.key <= '4') {
                const question = questions[currentQuestion];
                if (question.type === 'multiple') {
                    const optionIndex = parseInt(e.key) - 1;
                    if (optionIndex < question.options.length) {
                        selectOption(question.id, optionIndex);
                    }
                }
            }
        });

        // Auto-save answers to prevent loss
        setInterval(() => {
            if (Object.keys(userAnswers).length > 0) {
                localStorage.setItem('germanExamProgress', JSON.stringify({
                    currentQuestion,
                    userAnswers,
                    timeLeft
                }));
            }
        }, 10000);

        // Load saved progress
        function loadSavedProgress() {
            const saved = localStorage.getItem('germanExamProgress');
            if (saved) {
                const data = JSON.parse(saved);
                if (confirm('Would you like to continue your previous exam attempt?')) {
                    currentQuestion = data.currentQuestion;
                    userAnswers = data.userAnswers;
                    timeLeft = data.timeLeft;
                } else {
                    localStorage.removeItem('germanExamProgress');
                }
            }
        }

        // Initialize exam
        window.onload = function() {
            loadSavedProgress();
            startExam();
        };

        // Prevent accidental page reload
        window.addEventListener('beforeunload', function(e) {
            if (Object.keys(userAnswers).length > 0) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>